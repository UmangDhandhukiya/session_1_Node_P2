<%- include('layout/header')%>
<%- include('layout/sidebar') %>

<main class="col-md-10 main">
  <h1 class="text">All Courses</h1>

  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Duration</th>
        <th>Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if (courses.length > 0) { %>
        <% courses.map(course => { %>
          <tr>
            <td><%= course.id %></td>
            <td><%= course.courseName %></td>
            <td><%= course.courseDuration %>hr</td>
            <td> &#8377;<%= course.coursePrice %></td>
            <td>
             <div class="button">
              <!-- <a href="/course/edit/<%= course.id %>" class="btn edit-btn">Edit</a> -->
              <button data-bs-toggle="modal" data-bs-target="#courseModal"
              class="btn btn-md edit-btn"
              data-id="<%= course.id %>"
              data-name="<%= course.courseName %>"
              data-duration="<%= course.courseDuration %>"
              data-price="<%= course.coursePrice %>">
                Edit
              </button>    

              <!-- <form action="/course/<%= course.id %>" method="POST" style="display:inline-block;"> -->
                <button type="submit" class="btn btn-danger btn-md deleteButton" data-id="<%= course.id %>">Delete</button>
              <!-- </form> -->
             </div>
            </td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="5" style="text-align:center;">No courses found</td>
        </tr>
      <% } %>
    </tbody>
  </table>

<main class="modal fade" id="courseModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <form id="editCourseForm" method="POST" >

        <div class="modal-header">
          <h5 class="modal-title">Edit Course</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" id="courseName" name="courseName" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Duration</label>
            <input type="text" id="courseDuration" name="courseDuration" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Price</label>
            <input type="number" id="coursePrice" name="coursePrice" required>
          </div>

        </div>

        <div class="modal-footer">  
          <button type="submit" class="btn  submit-btn">
            Edit Course
          </button>
        </div>

      </form>

    </div>
  </div>
</main>


</div>
</div>
</div>
</body>

<script>
  
  const courseNameInput = document.getElementById('courseName');
  const durationInput = document.getElementById('courseDuration');
  const priceInput = document.getElementById('coursePrice');
  const form = document.querySelector('#editCourseForm');
  const deleteBtn = document.querySelectorAll('.deleteButton')
  const editButtons = document.querySelectorAll('.edit-btn');

editButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const id = btn.dataset.id;
    courseNameInput.value = btn.dataset.name;
    durationInput.value = btn.dataset.duration;
    priceInput.value = btn.dataset.price;

    form.action = `/editCourse/${id}`;
  });
});

deleteBtn.forEach(btn => {
  btn.addEventListener('click',async () => {
  console.log("btn")
  const id = btn.dataset.id;
  console.log(id)
  await fetch(`http://localhost:3000/course/${id}`,{
    method:"DELETE"
  })
  window.location.reload()
  });
});

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</html>
